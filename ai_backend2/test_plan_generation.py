"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –ø–ª–∞–Ω–∞ —Å—Ç–∞—Ç—å–∏
"""

import asyncio
import json
from openai_service import OpenAIService

# –¢–µ—Å—Ç–æ–≤—ã–µ —á–∞–Ω–∫–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –æ —Ö–æ–ª–æ–¥–Ω–æ–π –≤—ã—Å–∞–¥–∫–µ
TEST_CHUNKS = [
    {
        "text": "–•–æ–ª–æ–¥–Ω–∞—è –≤—ã—Å–∞–¥–∫–∞ - —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –∫—Ä–µ–ø–µ–∂–Ω—ã—Ö –∏–∑–¥–µ–ª–∏–π –º–µ—Ç–æ–¥–æ–º –ø–ª–∞—Å—Ç–∏—á–µ—Å–∫–æ–π –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–µ—Ç–∞–ª–ª–∞ –±–µ–∑ –Ω–∞–≥—Ä–µ–≤–∞. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –±–æ–ª—Ç—ã, –≥–∞–π–∫–∏, –≤–∏–Ω—Ç—ã –∏ –¥—Ä—É–≥–∏–µ –º–µ—Ç–∏–∑—ã —Å –≤—ã—Å–æ–∫–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ—á–Ω–æ—Å—Ç—å—é. –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ö–æ–ª–æ–¥–Ω–æ–π –≤—ã—Å–∞–¥–∫–∏ –≤–∫–ª—é—á–∞—é—Ç —ç–∫–æ–Ω–æ–º–∏—é –º–∞—Ç–µ—Ä–∏–∞–ª–∞, –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ—Ç–ª–∏—á–Ω—ã–µ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≥–æ—Ç–æ–≤—ã—Ö –∏–∑–¥–µ–ª–∏–π.",
        "priority": "high",
        "word_count": 45
    },
    {
        "text": "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–π –≤—ã—Å–∞–¥–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ—Å—Å—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —à—Ç–∞–º–ø–∞–º–∏. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–∞—à–∏–Ω—ã –æ—Å–Ω–∞—â–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –ø–æ–¥–∞—á–∏ –∑–∞–≥–æ—Ç–æ–≤–æ–∫, –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —É–¥–∞–ª–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã—Ö –∏–∑–¥–µ–ª–∏–π. –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤: –ø–æ–¥–∞—á–∞ –ø—Ä–æ–≤–æ–ª–æ–∫–∏, –æ—Ç—Ä–µ–∑–∞–Ω–∏–µ –∑–∞–≥–æ—Ç–æ–≤–∫–∏, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–æ—Ä–º–æ–≤–∫–∞, —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤—ã—Å–∞–¥–∫–∞ –∏ –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞. –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø —Ç—Ä–µ–±—É–µ—Ç —Ç–æ—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–∞–≤–ª–µ–Ω–∏—è –∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã.",
        "priority": "high", 
        "word_count": 52
    },
    {
        "text": "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Ö–æ–ª–æ–¥–Ω–æ–π –≤—ã—Å–∞–¥–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–±–ª–∞–¥–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏: —Ö–æ—Ä–æ—à–µ–π –ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å—é, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–π –ø—Ä–æ—á–Ω–æ—Å—Ç—å—é –∏ –∫–æ—Ä—Ä–æ–∑–∏–æ–Ω–Ω–æ–π —Å—Ç–æ–π–∫–æ—Å—Ç—å—é. –ß–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —É–≥–ª–µ—Ä–æ–¥–∏—Å—Ç—ã–µ –∏ –ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞–ª–∏ –º–∞—Ä–æ–∫ 10, 20, 35, 45, –∞ —Ç–∞–∫–∂–µ –Ω–µ—Ä–∂–∞–≤–µ—é—â–∏–µ —Å—Ç–∞–ª–∏ AISI 304, AISI 316. –í—ã–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –≥–æ—Ç–æ–≤–æ–º—É –∏–∑–¥–µ–ª–∏—é –∏ —É—Å–ª–æ–≤–∏–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.",
        "priority": "medium",
        "word_count": 48
    },
    {
        "text": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ö–æ–ª–æ–¥–Ω–æ–π –≤—ã—Å–∞–¥–∫–∏ –≤–∫–ª—é—á–∞—é—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Å—Ç–µ–ø–µ–Ω—å –æ–±–∂–∞—Ç–∏—è, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –∫–∞—á–µ—Å—Ç–≤–æ —Å–º–∞–∑–∫–∏. –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏, —Ä–∞–∑–º–µ—Ä–æ–≤ –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –∏ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å–≤–æ–π—Å—Ç–≤ –≥–æ—Ç–æ–≤–æ–≥–æ –∏–∑–¥–µ–ª–∏—è. –í–∞–∂–Ω—ã–º —Ñ–∞–∫—Ç–æ—Ä–æ–º —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —Å–º–∞–∑–æ—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–Ω–∏–∂–∞—é—Ç —Ç—Ä–µ–Ω–∏–µ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –ø—Ä–∏–ª–∏–ø–∞–Ω–∏–µ –º–µ—Ç–∞–ª–ª–∞ –∫ —à—Ç–∞–º–ø–∞–º.",
        "priority": "medium",
        "word_count": 49
    },
    {
        "text": "–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–∏ —Ö–æ–ª–æ–¥–Ω–æ–π –≤—ã—Å–∞–¥–∫–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞. –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Ä–∞–∑–º–µ—Ä—ã –≥–æ—Ç–æ–≤—ã—Ö –∏–∑–¥–µ–ª–∏–π, –∏—Ö –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞, —Ç–≤–µ—Ä–¥–æ—Å—Ç—å –∏ –º–∏–∫—Ä–æ—Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–∫–ª—é—á–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö –æ—Ç –Ω–æ—Ä–º—ã.",
        "priority": "low",
        "word_count": 44
    }
]

async def test_plan_generation():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø–ª–∞–Ω–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–¥—Ö–æ–¥–∞–º–∏"""
    
    print("üß™ –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞ —Å—Ç–∞—Ç—å–∏")
    print("=" * 60)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º OpenAI —Å–µ—Ä–≤–∏—Å
    openai_service = OpenAIService()
    
    # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–æ–≤
    chunks_text = "\n\n".join([
        f"–ß–∞–Ω–∫ {i+1} (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {chunk['priority']}, —Å–ª–æ–≤: {chunk['word_count']}):\n{chunk['text']}"
        for i, chunk in enumerate(TEST_CHUNKS)
    ])
    
    print(f"üìä –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ {len(TEST_CHUNKS)} —Ç–µ—Å—Ç–æ–≤—ã—Ö —á–∞–Ω–∫–æ–≤")
    print(f"üìù –û–±—â–∞—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: {len(chunks_text)} —Å–∏–º–≤–æ–ª–æ–≤")
    print()
    
    # –¢–µ—Å—Ç 1: –¢–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç
    print("üî¨ –¢–ï–°–¢ 1: –¢–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç")
    print("-" * 40)
    
    try:
        result1 = await openai_service.generate_article_plan(
            chunks_text=chunks_text,
            topic="—Ö–æ–ª–æ–¥–Ω–∞—è –≤—ã—Å–∞–¥–∫–∞",
            temperature=0.3,
            max_tokens=3000
        )
        
        print("‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:")
        print(result1['plan_text'])
        print()
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")
        print()
    
    # –¢–µ—Å—Ç 2: –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º
    print("üî¨ –¢–ï–°–¢ 2: –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º")
    print("-" * 40)
    
    improved_system_prompt = """–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ü–†–û–ß–ò–¢–ê–¢–¨ –∏ –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–¢–¨ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã, –∞ –∑–∞—Ç–µ–º —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω —Å—Ç–∞—Ç—å–∏.

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. –°–ù–ê–ß–ê–õ–ê –ø—Ä–æ—á–∏—Ç–∞–π –∫–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ
2. –í–´–î–ï–õ–ò –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ–º—ã –∏ –ø–æ–¥—Ç–µ–º—ã –≤ –∫–∞–∂–¥–æ–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç–µ
3. –°–û–ó–î–ê–ô –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –†–ï–ê–õ–¨–ù–û–ì–û —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
4. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

–ó–ê–ü–†–ï–©–ï–ù–û:
‚ùå "–í–≤–µ–¥–µ–Ω–∏–µ", "–û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å", "–ó–∞–∫–ª—é—á–µ–Ω–∏–µ"
‚ùå "–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–Ω–æ–≤—ã", "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ"
‚ùå –õ—é–±—ã–µ –æ–±—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑ —Å–≤—è–∑–∏ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –∏ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞
‚úÖ –°–æ–∑–¥–∞–≤–∞–π –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ–º
‚úÖ –£–∫–∞–∑—ã–≤–∞–π –Ω–æ–º–µ—Ä–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
1. [–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞]
   - –û–ø–∏—Å–∞–Ω–∏–µ: —á—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç —ç—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª
   - –§—Ä–∞–≥–º–µ–Ω—Ç—ã: –Ω–æ–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —á–∞–Ω–∫–æ–≤
   
2. [–°–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª]
   - –û–ø–∏—Å–∞–Ω–∏–µ: ...
   - –§—Ä–∞–≥–º–µ–Ω—Ç—ã: ..."""

    improved_user_prompt = f"""–ê–ù–ê–õ–ò–ó–ò–†–£–ô —Å–ª–µ–¥—É—é—â–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –æ —Ö–æ–ª–æ–¥–Ω–æ–π –≤—ã—Å–∞–¥–∫–µ –∏ —Å–æ–∑–¥–∞–π –ø–ª–∞–Ω —Å—Ç–∞—Ç—å–∏.

–°–ù–ê–ß–ê–õ–ê –ø—Ä–æ—á–∏—Ç–∞–π –∫–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∏ –≤—ã–¥–µ–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ–º—ã:
{chunks_text}

–°–û–ó–î–ê–ô –ø–ª–∞–Ω —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –†–ï–ê–õ–¨–ù–û–ì–û —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤.
–ö–∞–∂–¥—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–µ–º—É –∏–∑ —Ç–µ–∫—Å—Ç–∞.

–ü–†–ò–ú–ï–†–´ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è —ç—Ç–æ–π —Ç–µ–º—ã:
‚úÖ "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Ö–æ–ª–æ–¥–Ω–æ–π –≤—ã—Å–∞–¥–∫–∏ –º–µ—Ç–∏–∑–æ–≤"
‚úÖ "–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –∏ —ç—Ç–∞–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–∞"
‚úÖ "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞"
‚úÖ "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã"
‚úÖ "–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏"

–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∏–ø–∞ "–í–≤–µ–¥–µ–Ω–∏–µ" –∏–ª–∏ "–û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å"."""

    try:
        result2 = await openai_service.generate_article_plan(
            chunks_text=chunks_text,
            topic="—Ö–æ–ª–æ–¥–Ω–∞—è –≤—ã—Å–∞–¥–∫–∞",
            system_prompt=improved_system_prompt,
            user_prompt=improved_user_prompt,
            temperature=0.2,  # –°–Ω–∏–∂–∞–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
            max_tokens=3000
        )
        
        print("‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:")
        print(result2['plan_text'])
        print()
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")
        print()
    
    # –¢–µ—Å—Ç 3: –ü–æ—à–∞–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑
    print("üî¨ –¢–ï–°–¢ 3: –ü–æ—à–∞–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ —Å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ–º —Ç–µ–º")
    print("-" * 40)
    
    analysis_prompt = f"""–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤. 

–ó–ê–î–ê–ß–ê: –ü—Ä–æ—á–∏—Ç–∞–π –∫–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∏ –∏–∑–≤–ª–µ–∫–∏ –∏–∑ –Ω–µ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ–º—ã –∏ –ø–æ–¥—Ç–µ–º—ã.

–§–†–ê–ì–ú–ï–ù–¢–´:
{chunks_text}

–ò–ù–°–¢–†–£–ö–¶–ò–Ø:
1. –ü—Ä–æ—á–∏—Ç–∞–π –∫–∞–∂–¥—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ
2. –í—ã–¥–µ–ª–∏ 2-3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ–º—ã –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞
3. –ó–∞–ø–∏—à–∏ —Ç–µ–º—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ: "–§—Ä–∞–≥–º–µ–Ω—Ç X: [—Ç–µ–º–∞ 1], [—Ç–µ–º–∞ 2], [—Ç–µ–º–∞ 3]"
4. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—â–∏–µ —Å–ª–æ–≤–∞, —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ–º—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞

–ü–†–ò–ú–ï–†:
–§—Ä–∞–≥–º–µ–Ω—Ç 1: —Ö–æ–ª–æ–¥–Ω–∞—è –≤—ã—Å–∞–¥–∫–∞, –ø–ª–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è, –∫—Ä–µ–ø–µ–∂–Ω—ã–µ –∏–∑–¥–µ–ª–∏—è
–§—Ä–∞–≥–º–µ–Ω—Ç 2: –ø—Ä–µ—Å—Å—ã —Å–æ —à—Ç–∞–º–ø–∞–º–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã, —ç—Ç–∞–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–∞

–ù–∞—á–Ω–∏ –∞–Ω–∞–ª–∏–∑:"""

    try:
        # –°–Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        analysis_result = await openai_service._call_openai(
            messages=[
                {"role": "system", "content": "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤."},
                {"role": "user", "content": analysis_prompt}
            ],
            temperature=0.1,
            max_tokens=2000,
            model="gpt-4o"
        )
        
        print("üìã –ê–Ω–∞–ª–∏–∑ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤:")
        print(analysis_result)
        print()
        
        # –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–µ–º –ø–ª–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞
        plan_prompt = f"""–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–π –ø–ª–∞–Ω —Å—Ç–∞—Ç—å–∏.

–ê–ù–ê–õ–ò–ó –§–†–ê–ì–ú–ï–ù–¢–û–í:
{analysis_result}

–°–û–ó–î–ê–ô –ø–ª–∞–Ω —Å—Ç–∞—Ç—å–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã—Ö —Ç–µ–º.
–ö–∞–∂–¥—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤.

–§–û–†–ú–ê–¢:
1. [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–º]
   - –û–ø–∏—Å–∞–Ω–∏–µ: —á—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç —Ä–∞–∑–¥–µ–ª
   - –§—Ä–∞–≥–º–µ–Ω—Ç—ã: –Ω–æ–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —á–∞–Ω–∫–æ–≤

2. [–°–ª–µ–¥—É—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫]
   - –û–ø–∏—Å–∞–Ω–∏–µ: ...
   - –§—Ä–∞–≥–º–µ–Ω—Ç—ã: ..."""

        plan_result = await openai_service._call_openai(
            messages=[
                {"role": "system", "content": "–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Å—Ç–∞—Ç–µ–π."},
                {"role": "user", "content": plan_prompt}
            ],
            temperature=0.2,
            max_tokens=2000,
            model="gpt-4o"
        )
        
        print("üìù –ü–ª–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞:")
        print(plan_result)
        print()
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}")
        print()

if __name__ == "__main__":
    asyncio.run(test_plan_generation()) 